\chapter{\textit{Application Programming Interface}} \label{cap:api}

De acordo com \citeonline{understanding_web}, uma API é uma interface que permite que os 
usuários interajam ou respondam a dados ou serviços solicitados de outro programa, outros
aplicativos ou sites. No contexto da Web, as APIs facilitam a troca de dados entre 
aplicações, permitem a criação de novas aplicações e constituem a base para o conceito de 
"Web como uma plataforma".

A criação de uma API para o contexto deste trabalho é adequada, pois promove um fraco acoplamento
entre os componentes da aplicação, não sobrecarregando o ``Empurrando Juntos'' com funcionalidades genéricas
para as conversas e de agrupamento dos usuários,
permitindo a reutilização dos serviços de clusterização por qualquer
outra aplicação que já existe ou que venha a ser criada, tanto \textit{web} como \textit{mobile}.

Com uma API é possível criar uma solução que contribua para o propósito do ``Empurrando Juntos'' e que também
possa ser utilizada em outras aplicações, como uma plataforma para apoio à mulheres vítimas de violência, que é
um dos objetivos deste trabalho.

\citeonline{wagh2012comparative} afirmam que existem vários métodos para interação entre o  
usuário e a Internet, através de serviços web (web \textit{services}).
Essa arquitetura permite que os componentes de software, o que inclui funções,
objetos e processos de diferentes sistemas, sejam expostos como um serviço.

Para prover esses serviços através de uma API duas arquiteturas se destacam atualmente como representantes do provimento
de serviços via \textit{Web}: SOAP e REST.

\section{\textit{Simple Object Access Protocol} (SOAP)}

O protocolo SOAP é uma arquitetura de web \textit{service} baseada em três entidades: o provedor, o registrador e o consumidor do serviço. O provedor é entendido como o serviço endereçado na rede
que aceita requisições. O consumidor é uma aplicação, serviço ou outro tipo de software que
requisita um serviço e um registrador é um diretório na rede que contém os serviços disponíveis \cite{mumbaikar}.

% colocar o significado de cada sigla.
A comunicação é realizada através de mensagens que podem ser trocadas por meio dos protocolos SMTP, FTP e HTTP. 
Cada mensagem é um documento XML estruturado em duas partes: o cabeçalho e o corpo da mensagem. No cabeçalho
estão contidas as informações relacionadas ao protocolo, mas que não são visíveis à aplicação e o corpo da mensagem  
contém as mensagens e os métodos a serem chamados \cite{mumbaikar, unraveling_soap, soap_and_ws}. 
Um serviço implementado com SOAP sempre retorna um documento XML \cite{wagh2012comparative}.

Abaixo, é apresentada a estrutura de uma mensagem SOAP, adaptado de \citeonline{unraveling_soap}. 

%  CODE EXAMPLE FROM - UNRAVELING THE WEB SERVICES  - unraveling_soap
\lstset{language=XML}
\begin{lstlisting}
<SOAP:Envelope xmlns:SOAP= “http://schemas.xmlsoap.org/soap/envelope/”>
    <SOAP:Header>
    <!— conteúdo do cabeçalho —>
    </SOAP:Header>
    <SOAP:Body>
    <!— conteúdo do corpo (Mensagens, métodos, atributos)—>
    </SOAP:Body>
</SOAP:Envelope> 
\end{lstlisting}

Todas as definições de métodos disponíveis, entradas e saídas (requisições e respostas) são definidas utilizando uma linguagem específica: Web Services Description Language (WSDL) \cite{soap_and_ws}. Essa definição também é feita em um documento XML e é utilizada para conhecimento de como o serviço funciona.

Desse modo, a aplicação que deseja consumir o serviço provido por meio do SOAP deve conhecer esse documento de definições e implementar suas requisições com as entradas
definidas. E assim estabelecer a comunicação através da troca de mensagens estruturadas em documentos XML. O protocolo SOAP mostra-se bastante eficiente em seu propósito, todavia é relatado que o uso de XML pode comprometer a performance da aplicação, considerando a sua estrutura com informações legíveis aos seres humanos \cite{wagh2012comparative, soap_and_ws}.

% \citeonline{wagh2012comparative} afirma que as mensagens SOAP tem um conteúdo pesado e por esse motivo não sendo sendo indicadas para dispositivos móveis.

\section{\textit{Representational State Transfer} (REST) }

  A Transferência de Estado Representacional (do inglês, \textit{Representational State Transfer} ou REST)
  é um estilo arquitetural introduzido por \citeonline{fielding2002} que serve como um modelo abstrato
  para guiar o uso do \textit{Hypertext Transfer Protocol} (HTTP) e do \textit{Uniform Resource Identifier} (URI)
  na arquitetura da Web moderna, abstraindo os elementos arquiteturais participantes de um sistema de
  hipermídia distribuído.
  
  \citeonline{perry1992} classificam os elementos arquiteturais em elementos de processamento (componentes),
  elementos de dados e elementos de conexão (conectores). O estilo REST foca no papel dos componentes, nas restrições
  da interação entre componentes e na interpretação de elementos de dados significantes para a interação \cite{fielding2002}.
  
  O estilo REST é um conjunto coordenado de restrições arquiteturais que possibilita baixo acoplamento entre os componentes,
  minimização da latência da comunicação e favorece a escalabilidade da implementação dos componentes \cite{fielding2002}.
  
  \subsection{Elementos de processamento}
  
    Componentes REST se comunicam transferindo uma representação do dado (informação) em algum formato padrão que pode
    ser selecionado dinamicamente com base nas preferências do destinatário \cite{fielding2002}. Além dos dados contidos na 
    informação, uma representação contém também metadados descrevendo os dados e, possivelmente, metadados sobre os
    metadados \cite{fielding2002}.
    
    O estilo REST possui uma natureza \textit{stateless} (sem estado), ou seja, cada requisição deve ser autosuficiente, sem
    dependência de outras interações. Isso possibilita a implementação de serviços utilizando uma estrutura complexa de componentes
    intermediários e múltiplos servidores de origem, caracterizando um aspecto interessante em um cenário distribuído \cite{fielding2002}.
    \citeonline{fielding2002} afirmam que a arquitetura REST foi desenvolvida para atender as necessidades de um sistema de
    hipermídia distribuído, onde a interação entre componentes consiste em transferência de grande quantidade de dados.
    
    A Tabela \ref{rest-components-elements} apresenta os tipos de componentes no REST.
  
    \begin{table}[ht!]
    \centering
    \caption{Tipos de componentes da arquitetura REST. Traduzido e adaptado de \cite{fielding2002}.}
    \label{rest-components-elements}
    \begin{tabular}{l|l}
    \hline
    \multicolumn{1}{c|}{\textbf{Tipos de componentes}} & \multicolumn{1}{c}{\textbf{Exemplos}} \\ \hline
    servidor de origem                                  & Apache httpd, Nginx                    \\ \hline
    \textit{gateway}                                    & Squid, CGI, Proxy reverso              \\ \hline
    proxy                                               & CERN Proxy, Netscape Proxy             \\ \hline
    agente de usuário                                   & Google Chrome, Mozilla Firefox, Lynx   \\ \hline
    \end{tabular}
    \end{table}
  
  \subsection{Elementos de dados}
    
    No estilo REST, uma informação é abstraída em um recurso, que pode ser qualquer informação que possa ser nomeada
    (documentos, imagens, serviços, entre outros).
    
    Para \citeonline{fielding2002}, um recurso é um mapeamento conceitual para um conjunto de entidades e não a entidade mapeada
    em um determinado espaço no tempo. Em termos matemáticos, um recurso \textit{R} é uma função de associação variável no tempo, a qual, em um 
    determinado tempo \textit{t}, mapeia um conjunto de valores, onde esses valores podem ser representações do recurso em questão ou
    outros identificadores de recursos.
    Com essa definição abstrata de um recurso é importante salientar que a semântica de um mapeamento de um recurso dever permanecer
    estática, uma vez que esta semântica é o que permite distinguir os recursos \cite{fielding2002}.
    Para identificar um recurso específico na interação entre dois componentes, o REST utiliza um identificador de recurso \cite{fielding2002}.
    
    A Tabela \ref{rest-data-elements} apresenta os elementos de dados no REST.
    
    \begin{table}[ht!]
    \centering
    \caption{Elementos de dados da arquitetura REST. Traduzido de \cite{fielding2002}.}
    \label{rest-data-elements}
    \begin{tabular}{l|l}
    \hline
    \multicolumn{1}{c|}{\textbf{Elementos de dados}} & \multicolumn{1}{c}{\textbf{Exemplos}}                                                             \\ \hline
    recurso                                           & \begin{tabular}[c]{@{}l@{}}alvo conceitual desejado de uma\\ referência de hipertexto\end{tabular} \\ \hline
    identificador de recurso                          & URI, URN                                                                                           \\ \hline
    representação                                     & documento HTML, imagem JPEG                                                                        \\ \hline
    metadados da representação                        & tipo de mídia, last-modified-time                                                                  \\ \hline
    metadados do recurso                              & link da fonte, alternativas                                                                        \\ \hline
    dados de controle                                 & if-modified-since, cache-control                                                                   \\ \hline
    \end{tabular}
    \end{table}
  
  \subsection{Elementos de conexão}
  
    Os conectores na arquitetura REST fornecem uma interface genérica para acessar e manipular o conjunto de valores de um ou mais recursos,
    encapsulando as atividades de acesso aos recursos e de transferência de representações de recursos \cite{fielding2002}.
    Os conectores gerenciam a comunicação de rede de um componente. 
    O encapsulamento possibilitado pelos conectores permite que seja possível se comunicar na Web por meio de diferentes protocolos,
    embora o HTTP seja o protocolo de transferência primário \cite{fielding2002}.
    
    A Tabela \ref{rest-connectors-elements} apresenta os tipos de conectores no REST.
    
    \begin{table}[ht!]
    \centering
    \caption{Tipos de conectores da arquitetura REST. Traduzido de \cite{fielding2002}.}
    \label{rest-connectors-elements}
    \begin{tabular}{l|l}
    \hline
    \multicolumn{1}{c|}{\textbf{Tipos de conectores}} & \multicolumn{1}{c}{\textbf{Exemplos}} \\ \hline
    cliente                                            & libwww, libwww-perl                    \\ \hline
    servidor                                           & libwww, Apache API                     \\ \hline
    cache                                              & browser cache, Akamai cache network    \\ \hline
    resolvedor                                         & bind (biblioteca DNS)                  \\ \hline
    túnel                                              & SOCKS, SSL                             \\ \hline
    \end{tabular}
    \end{table}

\section{Comparação entre as arquiteturas}
      
    Apesar de ambas as tecnologias proverem meios para fornecer serviços pela \textit{web}, o estilo arquitetural REST se destacou
    e as principais diferenças entre as tecnologias que culminaram na escolha do REST são apresentadas na Tabela \ref{soap_vs_rest}.
    
    \begin{table}[ht!]
    \centering
    \caption{Principais diferenças entre SOAP e REST. Adaptado de \cite{wagh2012comparative}.}
    \label{soap_vs_rest}
    \begin{tabular}{l|l}
    \hline
    \multicolumn{1}{c|}{\textbf{SOAP}}                & \multicolumn{1}{c}{\textbf{REST}}                \\ \hline
    XML obrigatório como tipo de dado                                                            & \begin{tabular}[c]{@{}l@{}}Tipo de dado flexível\\ (geralmente JSON para APIs)\end{tabular} \\ \hline
    \begin{tabular}[c]{@{}l@{}}Complicado de implementar,\\ requer ferramentas\end{tabular}      & Mais simples de implementar                                                                 \\ \hline
    Requisições mais pesadas                                                                     & Requisições mais leves                                                                      \\ \hline
    \begin{tabular}[c]{@{}l@{}}Interações mais acopladas\\ entre cliente e servidor\end{tabular} & \begin{tabular}[c]{@{}l@{}}Interações desacopladas entre\\  cliente e servidor\end{tabular} \\ \hline
    \begin{tabular}[c]{@{}l@{}}Agnóstico de protocolo de\\  camada de aplicação\end{tabular}     & Assume HTTP como protocolo                                                                  \\ \hline
    \end{tabular}
    \end{table}
    
    
    